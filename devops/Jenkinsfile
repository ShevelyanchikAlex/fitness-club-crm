pipeline {
        agent any
        environment {
            PROJECT_ID = 'skilful-display-384007'
            CLUSTER_NAME = 'fitness-club-cluster'
            LOCATION = 'europe-central2-a'
            CREDENTIALS_ID = 'fitness-club'
        }
        stages {
            stage('Add script permission') {
                steps {
                   sh 'chmod +x devops/add-script-permission.sh'
                   sh 'devops/add-script-permission.sh'
                }
            }

            stage('Project build') {
                steps {
                    sh 'bash devops/gce-build.sh'
                }
            }

            stage('Docker build') {
                steps {
                    sh 'bash devops/gce-docker-build.sh'
                }
            }

            stage('Docker push') {
                steps {
                    sh 'bash devops/gce-docker-push.sh'
                }
            }

            stage('Kubernetes deploy') {
                 steps {
                    sh 'devops/gce-kubernetes-deploy.sh'

                    step([
                    $class: 'KubernetesEngineBuilder',
                    projectId: env.PROJECT_ID,
                    clusterName: env.CLUSTER_NAME,
                    location: env.LOCATION,
                    manifestPattern: 'k8s-cloud',
                    credentialsId: env.CREDENTIALS_ID,
                    verifyDeployments: true])

//                    withCredentials([usernamePassword(credentialsId: 'jenkins-github',
//                                                      usernameVariable: 'username',
//                                                      passwordVariable: 'password')]){
//                       sh "git push https://$username:$password@github.com/ShevelyanchikAlex/fitness-club-service.git --all"
//                    }
                 }
            }
        }
    }