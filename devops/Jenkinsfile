pipeline {
        agent any

        stages {
            stage('Project build') {
                steps {
                    sh 'devops/build.sh'
                }
            }

            stage('Docker build') {
                steps {
                    sh 'devops/docker-build.sh'
                }
            }

            stage('Docker push') {
                steps {
                    sh 'devops/docker-push.sh'
                }
            }

            stage('Kubernetes deploy') {
                steps {
                    withCredentials([usernamePassword(credentialsId: 'fitness-club-push',
                                                     usernameVariable: 'username',
                                                     passwordVariable: 'password')]){

                        sh 'devops/kubernetes-deploy.sh'
                        sh "git push https://$username:$password@github.com/ShevelyanchikAlex/fitness-club-service.git --all"
                    }
                }
            }
        }
    }